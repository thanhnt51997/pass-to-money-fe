# Update Template Questions (Bulk)

API cho phép Admin cập nhật hoặc sắp xếp lại nhiều câu hỏi trong template cùng lúc.

## Endpoint
`PATCH /api/admin/templates/{id}/questions`

## Authentication
Required (JWT Token) - Admin only

## Request Body (JSON)
```json
{
  "questions": [
    {
      "question_id": "8a1b2c3d-4567-89ab-cdef-0123456789ab",
      "order": 1,
      "weight": 3.0,
      "mandatory": true,
      "time_limit": 900
    },
    {
      "question_id": "7b2c3d4e-5678-9abc-def0-123456789abc",
      "order": 2,
      "weight": 2.5
    },
    {
      "question_id": "6c3d4e5f-6789-abcd-ef01-23456789abcd",
      "order": 3,
      "time_limit": 600
    }
  ]
}
```

## Validation Rules
- `questions`: required, array
- `questions.*.question_id`: required, string (UUID)
- `questions.*.order`: optional, integer, min 0
- `questions.*.weight`: optional, numeric, min 0.01
- `questions.*.mandatory`: optional, boolean
- `questions.*.time_limit`: optional, integer (seconds), min 1

## Response Success (200 OK)
```json
{
  "success": true,
  "message": "Template questions updated successfully."
}
```

## Capabilities

### 1. Reorder Questions
Chỉ cần gửi `question_id` và `order` mới:
```json
{
  "questions": [
    {"question_id": "q1-uuid", "order": 3},
    {"question_id": "q2-uuid", "order": 1},
    {"question_id": "q3-uuid", "order": 2}
  ]
}
```

### 2. Update Weight
Chỉ update weight, giữ nguyên order:
```json
{
  "questions": [
    {"question_id": "q1-uuid", "weight": 5.0},
    {"question_id": "q2-uuid", "weight": 2.5}
  ]
}
```

### 3. Update Time Limit
```json
{
  "questions": [
    {"question_id": "q1-uuid", "time_limit": 1200},
    {"question_id": "q2-uuid", "time_limit": 600}
  ]
}
```

### 4. Bulk Update (All Fields)
```json
{
  "questions": [
    {
      "question_id": "q1-uuid",
      "order": 1,
      "weight": 3.0,
      "mandatory": true,
      "time_limit": 900
    }
  ]
}
```

## Business Rules
- **Partial update**: Chỉ update các field được gửi
- **Skip invalid questions**: Nếu question_id không tồn tại trong template → skip (không báo lỗi)
- **Weight validation**: Weight phải > 0
- **Order uniqueness**: Không validate unique order trong bulk update (admin tự quản lý)

## Error Cases
- **400 Bad Request**: 
  - Validation failed
  - Weight <= 0
- **401 Unauthorized**: Missing hoặc invalid token
- **403 Forbidden**: User không phải Admin
- **404 Not Found**: Template không tồn tại

## cURL Example
```bash
curl -X PATCH http://localhost:8000/api/admin/templates/9d2e5c8a-1234-5678-9abc-def012345678/questions \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "questions": [
      {
        "question_id": "8a1b2c3d-4567-89ab-cdef-0123456789ab",
        "order": 1,
        "weight": 3.0
      },
      {
        "question_id": "7b2c3d4e-5678-9abc-def0-123456789abc",
        "order": 2,
        "weight": 2.5
      }
    ]
  }'
```

## Use Cases

### Reorder toàn bộ questions
Khi admin drag-drop questions trong UI, gửi toàn bộ danh sách với order mới.

### Update weight cho weighted scoring
Khi sử dụng `scoring_strategy = "weighted"`, admin có thể điều chỉnh weight của từng câu.

### Adjust time limits
Điều chỉnh thời gian cho từng câu hỏi dựa trên độ khó thực tế.

## Notes
- API này **idempotent** - gọi nhiều lần với cùng data cho kết quả giống nhau
- Recommend: Gửi toàn bộ danh sách questions để đảm bảo consistency
- Nếu chỉ muốn update 1 question, vẫn có thể dùng API này (gửi array 1 phần tử)
