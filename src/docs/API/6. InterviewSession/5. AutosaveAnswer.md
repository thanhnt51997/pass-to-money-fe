# Autosave Answer

API để tự động lưu câu trả lời trong quá trình làm bài (không thay đổi trạng thái session).

## Endpoint
`POST /api/interviews/{id}/autosave`

## Authentication
Required (JWT Token) - Candidate

## Request Body (JSON)
```json
{
  "question_id": 1,
  "answer_content": "Laravel Service Container là một công cụ mạnh mẽ..."
}
```

## Validation Rules
- `question_id`: required, integer
- `answer_content`: required, mixed (string for essay, array for MCQ, object for voice)

## Response Success (200 OK)
```json
{
  "success": true,
  "message": "Answer autosaved successfully."
}
```

## Business Rules
1. **Idempotent**: Gọi nhiều lần với cùng data không gây lỗi
2. **Overwrite allowed**: Answer mới sẽ ghi đè answer cũ
3. **No state change**: Không thay đổi status của session
4. **No evaluation**: Không trigger AI evaluation
5. **Allowed status**: Chỉ autosave khi session ở status `started` hoặc `in_progress`
6. **time_spent = 0**: Autosave không track thời gian

## Answer Content Format

### Essay/Theoretical
```json
{
  "question_id": 1,
  "answer_content": "Câu trả lời dạng text..."
}
```

### MCQ (Multiple Choice)
```json
{
  "question_id": 2,
  "answer_content": ["A", "C"]
}
```

### Voice (Reference ID)
```json
{
  "question_id": 3,
  "answer_content": {
    "type": "voice",
    "reference_id": "voice_recording_abc123",
    "duration": 120
  }
}
```

## Use Cases
- **Auto-save every 30s**: Frontend tự động gọi API mỗi 30 giây
- **On blur**: Lưu khi user rời khỏi textarea
- **Before navigation**: Lưu trước khi chuyển câu hỏi

## Error Cases
- **400 Bad Request**:
  - Session không ở status `started` hoặc `in_progress`
  - Question không thuộc session
  - Validation failed
- **401 Unauthorized**: Missing hoặc invalid token
- **403 Forbidden**: Session không thuộc về user hiện tại

## cURL Example
```bash
curl -X POST http://localhost:8000/api/interviews/1/autosave \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "question_id": 1,
    "answer_content": "Laravel Service Container..."
  }'
```

## Notes
- **Không thay thế Submit Answer**: Vẫn cần call `POST /interviews/{id}/answers` để submit chính thức
- **UX improvement**: Giúp candidate không mất dữ liệu khi có sự cố
- **Performance**: Có thể debounce ở frontend để giảm số lần gọi API
